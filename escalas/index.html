<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prontuário Fácil - Escalas Médicas</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Prontuário Fácil - Escalas Médicas</h1>
            <p>Aplique escalas com cálculo automático de pontuação.</p>
           <div class="header-actions">
                <div></div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-secondary btn-small" onclick="exportData()">Exportar</button>
                    <label class="btn btn-secondary btn-small" style="display:inline-flex;align-items:center;cursor:pointer">Importar<input type="file" accept="application/json" onchange="handleImport(this.files[0])" style="display:none"></label>
                    <button class="btn btn-danger btn-small" onclick="masterReset()">Reset Total</button>
                </div>
            </div>
        </div>

        <div id="screen1" class="screen active">
            <h2>Selecione a Escala</h2>
            <div class="form-group" style="margin-bottom:20px"><input type="text" id="scaleSearchInput" onkeyup="renderScaleSelection()" placeholder="Buscar escala por nome..."></div>
            <div class="exam-grid" id="scaleGrid"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="proceedToScale()">Prosseguir</button>
                <button class="btn btn-secondary" onclick="toggleAddScaleForm()">Adicionar Nova Escala</button>
            </div>
<div id="addScaleForm" class="add-exam-form hidden">
<div class="form-group" style="display: flex; align-items: center; gap: 10px; justify-content: start;">
    <input type="checkbox" id="newScaleProgressive" style="width: auto; height: auto;">
    <label for="newScaleProgressive" style="margin-bottom: 0; font-weight: normal;">Esta é uma escala progressiva (lógica do "último sim", tipo PPS)</label>
</div>
    <h3 id="scaleFormTitle">Adicionar Nova Escala</h3>
    <div class="form-group">
        <label for="newScaleName">Nome da Escala:</label>
        <input type="text" id="newScaleName">
    </div>
    <div class="form-group">
        <label for="newScaleDescription">Descrição Curta (para o card de seleção):</label>
        <input type="text" id="newScaleDescription" placeholder="Um resumo breve da escala...">
    </div>
    <div class="form-group">
        <label for="newScaleInstructions">Instruções de Preenchimento (para a tela da escala):</label>
        <textarea id="newScaleInstructions" rows="5" placeholder="Insira aqui as instruções detalhadas, objetivos, ou referências da escala..."></textarea>
    </div>
    <div class="button-group">
        <button id="saveScaleBtn" class="btn btn-success" onclick="addNewScale()">Adicionar</button>
        <button class="btn btn-secondary" onclick="toggleAddScaleForm()">Cancelar</button>
    </div>
</div>
        </div>

        <div id="screen2" class="screen">
            <h2>Responda as Perguntas</h2>
			    <div id="scaleInstructionsContainer" style="margin-bottom: 25px;"></div>
    <div id="questionsContainer"></div>
    <div class="button-group">
        <button class="btn btn-secondary" onclick="backToSelection()">Voltar</button>
        <button class="btn btn-primary" onclick="generateReport()">Gerar Resultado</button>
    </div>
  
            <div id="previewPanel" class="preview-panel">
                <h3>Pré-visualização do Resultado</h3>
                <div id="previewContent">Selecione as respostas...</div>
            </div>
        </div>

        <div id="screen3" class="screen">
            <h2>Resultado da Escala</h2>
            <div id="resultArea" class="result-area"></div>
            <div class="button-group"><button class="btn btn-success" onclick="copyToClipboard()">Copiar</button><button class="btn btn-primary" onclick="startNew()">Nova Avaliação</button></div>
        </div>
    </div>

<div id="questionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="questionModalTitle">Adicionar/Editar Pergunta</h3><span class="close" onclick="closeQuestionModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="questionText">Pergunta:</label>
                <input type="text" id="questionText" placeholder="Ex: Paciente apresenta febre?">
            </div>
            <div class="form-group">
                <label for="questionExplanation">Explicação (Opcional):</label>
                <textarea id="questionExplanation" rows="3" placeholder="Descreva o que a pergunta avalia ou forneça contexto adicional..."></textarea>
            </div>
            <div class="form-group">
                <label>Respostas Possíveis:</label>
                <div id="answersContainer"></div>
                <button class="btn btn-secondary btn-small" onclick="addAnswerField()" style="margin-top:10px">+ Adicionar Resposta</button>
            </div>
            <div class="button-group">
                <button id="saveQuestionBtn" class="btn btn-success">Salvar</button>
                <button class="btn btn-secondary" onclick="closeQuestionModal()">Cancelar</button>
            </div>
        </div>
    </div>
   

    <div id="scaleSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="scaleSettingsModalTitle">Configurar Interpretação da Escala</h3><span class="close" onclick="closeScaleSettingsModal()">&times;</span></div>
            <p style="color: var(--cor-texto-secundario); margin-bottom: 20px;">Defina as faixas de pontuação e o texto de resultado correspondente.</p>
            <div class="form-group">
                <label>Regras de Interpretação:</label>
                <div class="interpretation-rule" style="font-weight: bold;">
                    <span>De (pontos)</span>
                    <span>Até (pontos)</span>
                    <span>Texto da Interpretação</span>
                    <span></span>
                </div>
                <div id="interpretationsContainer"></div>
                <button class="btn btn-secondary btn-small" onclick="addInterpretationRule()" style="margin-top:10px">+ Adicionar Faixa</button>
            </div>
            <div class="button-group">
                <button id="saveScaleSettingsBtn" class="btn btn-success">Salvar Configurações</button>
                <button class="btn btn-secondary" onclick="closeScaleSettingsModal()">Cancelar</button>
            </div>
        </div>
    </div>

<script src="escalasNativas.js"></script>
<script src="../js/utils.js"></script>
<script src="../js/scales.js"></script>

</body>
</html>