<!DOCTYPE html>
<html lang="pt-BR" class="dark" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prontuário Fácil | Exames</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="min-h-screen text-slate-100 antialiased transition-colors duration-500">
    <nav class="app-nav glass-nav mx-auto mt-6 max-w-6xl">
        <div class="flex flex-wrap items-center justify-between gap-4 px-6 py-4">
            <a href="index.html" class="text-2xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-emerald-300">Prontuário Fácil</a>
            <div class="hidden md:flex items-center gap-2 text-sm font-semibold">
                <a href="index.html" class="nav-link text-slate-100/80">Home</a>
                <a href="exames.html" class="nav-link text-white">Exames</a>
                <a href="escalas/index.html" class="nav-link text-slate-100/80">Escalas</a>
                <a href="prescricoes/index.html" class="nav-link text-slate-100/80">Prescrições</a>
                <a href="#" onclick="openHelpModal()" class="nav-link text-slate-100/80">Ajuda</a>
            </div>
            <div class="flex flex-wrap items-center gap-2 bg-white/5 rounded-2xl px-3 py-2 border border-white/10">
                <button id="export-button" class="px-4 py-2 text-sm font-semibold rounded-xl bg-slate-100/70 dark:bg-slate-800/70 text-gray-700 dark:text-gray-200 hover:bg-white hover:shadow-md transition" >Exportar</button>
                <label class="px-4 py-2 text-sm font-semibold rounded-xl bg-slate-100/70 dark:bg-slate-800/70 text-gray-700 dark:text-gray-200 hover:bg-white hover:shadow-md transition cursor-pointer">
                    Importar <input type="file" accept="application/json" onchange="handleImport(this.files[0])" class="hidden">
                </label>
                <button class="px-4 py-2 text-sm font-semibold rounded-xl bg-rose-500/90 text-white shadow-md hover:bg-rose-500" onclick="masterReset()">Reset Total</button>
            </div>
        </div>
    </nav>
    <header class="page-hero px-6">
        <span class="page-hero__badge">Exames físicos</span>
        <h1>Monte laudos consistentes com roteiros ricos e instruções clínicas integradas.</h1>
        <p>Selecione os sistemas necessários, personalize perguntas, consulte dicas rápidas e gere descrições completas em segundos.</p>
        <div class="hero-actions">
            <button class="btn btn-primary" onclick="document.getElementById('screen1').scrollIntoView({behavior:'smooth'});">Começar seleção</button>
            <div class="meta">
                <span>Dados locais</span>
                <span>Fluxo salvo</span>
            </div>
        </div>
    </header>
    <div class="page-shell">
            
                <div id="screen1" class="screen active container mx-auto max-w-6xl px-6 py-12">
                    <div class="glass-panel p-6 md:p-10">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div class="md:col-span-1">
                                <div class="glass-panel p-6 h-full sidebar-panel">
                                <h2 class="text-2xl font-bold mb-2">Roteiros de Exame Físico</h2>
                                <p class="text-slate-300 mb-4">Selecione um ou mais roteiros abaixo para iniciar a geração do seu laudo.</p>
                                <input type="text" id="examSearchInput" onkeyup="renderExamSelection()" placeholder="Buscar exame por nome..." class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md">
                                </div>
                            </div>
                            <div class="md:col-span-2">
                                <div class="exam-grid" id="examGrid"></div>
                                <div class="button-group mt-6">
                                    <button class="btn btn-primary" onclick="proceedToExam()">Prosseguir</button>
                                    <button class="btn btn-secondary" onclick="toggleAddExamForm()">Adicionar Novo Exame</button>
                                </div>
                                <div id="addExamForm" class="add-exam-form hidden mt-6 glass-panel p-6">
                                <h3 id="examFormTitle" class="text-xl font-bold mb-4">Adicionar Novo Exame</h3>
                                <div class="space-y-4">
                                    <div class="form-group"><label for="newExamName" class="block mb-1">Nome:</label><input type="text" id="newExamName" class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md"></div>
                                    <div class="form-group"><label for="newExamDescription" class="block mb-1">Descrição:</label><input type="text" id="newExamDescription" class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md"></div>
                                    <div class="button-group"><button id="saveExamBtn" class="btn btn-success" onclick="addNewExam()">Adicionar</button><button class="btn btn-secondary" onclick="toggleAddExamForm()">Cancelar</button></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                
                <div id="screen2" class="screen container mx-auto max-w-6xl px-6 py-12">
                    <div class="glass-panel p-6 md:p-10">
                        <h2 class="text-2xl font-bold mb-4">Registre os Achados</h2>
                        <div id="findingsContainer"></div>
                        <div class="button-group mt-6"><button class="btn btn-secondary" onclick="backToSelection()">Voltar</button><button class="btn btn-primary" onclick="generateReport()">Gerar Laudo</button></div>
                        <button id="togglePreviewBtn" class="toggle-preview-btn" aria-label="Alternar pré-visualização">»</button>
                        <div id="previewPanel" class="preview-panel">
                            <h3 class="text-xl font-bold mb-2">Pré-visualização</h3>
                            <div id="previewContent">Selecione os achados...</div>
                        </div>
                    </div>
                </div>
            
                <div id="screen3" class="screen container mx-auto max-w-6xl px-6 py-12">
                    <div class="glass-panel p-6 md:p-10">
                        <h2 class="text-2xl font-bold mb-4">Descrição do Exame Físico</h2>
                        <div id="resultArea" class="result-area glass-panel mt-4 p-4"></div>
                        <div class="button-group mt-6"><button class="btn btn-success" onclick="copyToClipboard()">Copiar</button><button class="btn btn-primary" onclick="newExam()">Novo Exame</button></div>
                    </div>
                </div>
                
                <div id="findingModal" class="modal">
                    <div class="modal-content p-6">
                        <div class="modal-header border-b border-gray-200 dark:border-gray-700 pb-4 mb-4">
                            <h3 id="findingModalTitle" class="text-xl font-bold">Adicionar/Editar Achado</h3>
                            <span class="close" onclick="closeFindingModal()">&times;</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="form-group">
                                <label for="findingType" class="block mb-1">Tipo de Pergunta:</label>
                                <select id="findingType" onchange="updateFindingModalUI()" class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md">
                                    <option value="multiple-choice">Múltipla Escolha / Sim-Não</option>
                                    <option value="open-text">Texto Aberto (ex: Sinais Vitais)</option>
                                </select>
                            </div>
            
                            <div class="form-group">
                                <label for="findingQuestion" class="block mb-1">Pergunta:</label>
                                <input type="text" id="findingQuestion" placeholder="Ex: Bulhas cardíacas? ou Frequência Cardíaca" class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md">
                            </div>
                            
                            <div class="bordered-section">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="conditionalCheckbox" onclick="toggleConditionalUI()" class="rounded">
                                    <strong>Exibição Condicional</strong>
                                </label>
                                <div id="conditionalControls" class="hidden mt-4 pl-4">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Exibir este achado somente se:</p>
                                    <div class="form-group mt-2">
                                        <label for="triggerFindingSelect" class="block mb-1">A resposta para o achado...</label>
                                        <select id="triggerFindingSelect" class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md"></select>
                                    </div>
                                    <div class="form-group mt-2">
                                        <label for="triggerAnswerSelect" class="block mb-1">...for igual a...</label>
                                        <select id="triggerAnswerSelect" class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md"></select>
                                    </div>
                                </div>
                            </div>
                            <div id="reportLabelGroup" class="form-group hidden">
                                <label for="findingReportLabel" class="block mb-1">Etiqueta para o Laudo (ex: FC):</label>
                                <input type="text" id="findingReportLabel" placeholder="Ex: FC, PA, FR, SpO2" class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md">
                            </div>
            
                            <div id="answersGroup">
                                <div class="form-group">
                                    <label class="block mb-1">Respostas Possíveis:</label>
                                    <div id="answersContainer" class="space-y-2"></div>
                                    <button class="btn btn-secondary btn-small mt-2" onclick="addAnswerField()">+ Adicionar Resposta</button>
                                </div>
                            </div>
            
                            <div class="form-group">
                                <label for="findingInfo" class="block mb-1">Texto de Informação (Opcional):</label>
                                <textarea id="findingInfo" rows="4" placeholder="Explique o que é este achado..." class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-md"></textarea>
                            </div>
                            <div class="button-group"><button id="saveFindingBtn" class="btn btn-success">Salvar</button><button class="btn btn-secondary" onclick="closeFindingModal()">Cancelar</button></div>
                        </div>
                    </div>
                </div>
            
                <div id="infoModal" class="modal">
                    <div class="modal-content p-6">
                        <div class="modal-header border-b border-gray-200 dark:border-gray-700 pb-4 mb-4">
                            <h3 class="text-xl font-bold">Informações sobre o Achado</h3>
                            <span class="close" onclick="closeInfoModal()">&times;</span>
                        </div>
                        <div id="infoModalContent" class="prose dark:prose-invert max-w-none"></div>
                    </div>
                </div>
            
                <div id="helpModal" class="modal">
                    <div class="modal-content p-6">
                        <div class="modal-header border-b border-gray-200 dark:border-gray-700 pb-4 mb-4">
                            <h3 class="text-xl font-bold">Como Usar o Prontuário Fácil</h3>
                            <span class="close" onclick="closeHelpModal()">&times;</span>
                        </div>
                        <div id="helpModalContent" class="prose dark:prose-invert max-w-none">
                            <h4>Passo 1: Selecione os Exames</h4>
                            <p>Na tela inicial, clique nos roteiros de examinação que deseja incluir na sua consulta. Os exames selecionados ficarão destacados. Você pode adicionar seus próprios exames customizados clicando em "Adicionar Novo Exame" (não recomendamos).</p>
                            
                            <h4>Passo 2: Registre os Achados</h4>
                            <p>Após selecionar os exames e clicar em "Prosseguir", você verá uma lista de seções e perguntas para cada exame. Clique nos botões (ex: "Sim", "Não") para registrar suas observações. Para perguntas de texto (como Sinais Vitais), basta digitar o valor no campo correspondente.</p>
                            <p>À direita, um painel de pré-visualização mostrará o laudo sendo montado em tempo real.</p>
                            
                            <h4>Passo 3: Gere e Copie o Laudo</h4>
                            <p>Quando terminar de registrar os achados, clique em "Gerar Laudo". O texto final será apresentado. Você pode então clicar em "Copiar" para transferir o laudo para a área de transferência e colar onde precisar.</p>
            
                            <hr class="my-4">
            
                            <h4>Recursos Adicionais:</h4>
                            <ul class="list-disc pl-5">
                                <li><strong>Adicionar Achados:</strong> Dentro de um exame, na tela de registro, você pode adicionar perguntas customizadas (achados) a qualquer seção clicando no botão "+".</li>
                                <li><strong>Importar/Exportar:</strong> Use os botões no cabeçalho para salvar ("Exportar") suas configurações de exames e achados customizados em um arquivo. Você pode carregar ("Importar") esse arquivo em outro computador ou navegador para ter seus dados sempre à mão.</li>
                                <li><strong>Limpar Sessão:</strong> Este botão apaga os exames e achados selecionados na sua sessão atual, permitindo começar um novo laudo do zero.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            
    </div>
    <script src="dadosnativos.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currentPage = window.location.pathname.split('/').pop();
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                const linkPage = link.getAttribute('href').split('/').pop();
                if (linkPage === currentPage || (currentPage === '' && linkPage === 'index.html')) {
                    link.classList.add('selected');
                }
            });
        });
    </script>
</body>
</html>
            