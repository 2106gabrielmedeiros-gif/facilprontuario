<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prontuário Fácil</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Prontuário Fácil</h1>
            <p>Versão 0.0.8</p>
           <div class="header-actions">
                <div class="left-actions">
                    <button class="btn btn-primary btn-small" onclick="location.href='escalas/index.html'">Acessar Escalas</button>
                    <button class="btn btn-primary btn-small" onclick="location.href='prescricoes/index.html'">Acessar Prescrições</button>
                    <button class="btn btn-primary btn-small" onclick="openHelpModal()">Ajuda</button>
                </div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button class="btn btn-secondary btn-small" onclick="exportData()">Exportar</button>
                    <label class="btn btn-secondary btn-small" style="display:inline-flex;align-items:center;cursor:pointer">Importar<input type="file" accept="application/json" onchange="handleImport(this.files[0])" style="display:none"></label>
                    <button class="btn btn-danger btn-small" onclick="masterReset()">Reset Total</button>
                    <button id="theme-toggle" class="theme-toggle-btn">?</button>
                </div>
            </div>
        </div>

        <div id="screen1" class="screen active">
            <h2>Selecione os Exames</h2>
            <div class="form-group" style="margin-bottom:20px"><input type="text" id="examSearchInput" onkeyup="renderExamSelection()" placeholder="Buscar exame por nome..."></div>
            <div class="exam-grid" id="examGrid"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="proceedToExam()">Prosseguir</button>
                <button class="btn btn-secondary" onclick="toggleAddExamForm()">Adicionar Novo Exame</button>
            </div>
            <div id="addExamForm" class="add-exam-form hidden">
                <h3 id="examFormTitle">Adicionar Novo Exame</h3>
                <div class="form-group"><label for="newExamName">Nome:</label><input type="text" id="newExamName"></div>
                <div class="form-group"><label for="newExamDescription">Descrição:</label><input type="text" id="newExamDescription"></div>
                <div class="button-group"><button id="saveExamBtn" class="btn btn-success" onclick="addNewExam()">Adicionar</button><button class="btn btn-secondary" onclick="toggleAddExamForm()">Cancelar</button></div>
            </div>
        </div>

        <div id="screen2" class="screen">
            <h2>Registre os Achados</h2>
            <div id="findingsContainer"></div>
            <div class="button-group"><button class="btn btn-secondary" onclick="backToSelection()">Voltar</button><button class="btn btn-primary" onclick="generateReport()">Gerar Laudo</button></div>
            <button id="togglePreviewBtn" class="toggle-preview-btn" aria-label="Alternar pré-visualização">»</button>
            <div id="previewPanel" class="preview-panel">
                <h3>Pré-visualização</h3>
                <div id="previewContent">Selecione os achados...</div>
            </div>
        </div>

        <div id="screen3" class="screen">
            <h2>Descrição do Exame Físico</h2>
            <div id="resultArea" class="result-area"></div>
            <div class="button-group"><button class="btn btn-success" onclick="copyToClipboard()">Copiar</button><button class="btn btn-primary" onclick="newExam()">Novo Exame</button></div>
        </div>
    </div>

    <div id="findingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="findingModalTitle">Adicionar/Editar Achado</h3><span class="close" onclick="closeFindingModal()">&times;</span></div>
            
            <div class="form-group">
                <label for="findingType">Tipo de Pergunta:</label>
                <select id="findingType" onchange="updateFindingModalUI()">
                    <option value="multiple-choice">Múltipla Escolha / Sim-Não</option>
                    <option value="open-text">Texto Aberto (ex: Sinais Vitais)</option>
                </select>
            </div>

            <div class="form-group"><label for="findingQuestion">Pergunta:</label><input type="text" id="findingQuestion" placeholder="Ex: Bulhas cardíacas? ou Frequência Cardíaca"></div>
            
            <div class="form-group" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="conditionalCheckbox" onclick="toggleConditionalUI()">
                    <strong>Exibição Condicional</strong>
                </label>
                <div id="conditionalControls" class="hidden" style="margin-top: 10px; padding-left: 20px;">
                    <p style="font-size: 0.9em; color: #6c757d;">Exibir este achado somente se:</p>
                    <div class="form-group">
                        <label for="triggerFindingSelect">A resposta para o achado...</label>
                        <select id="triggerFindingSelect" class="form-control" style="width:100%; padding:8px;"></select>
                    </div>
                    <div class="form-group">
                        <label for="triggerAnswerSelect">...for igual a...</label>
                        <select id="triggerAnswerSelect" class="form-control" style="width:100%; padding:8px;"></select>
                    </div>
                </div>
            </div>
            <div id="reportLabelGroup" class="form-group hidden">
                <label for="findingReportLabel">Etiqueta para o Laudo (ex: FC):</label>
                <input type="text" id="findingReportLabel" placeholder="Ex: FC, PA, FR, SpO2">
            </div>

            <div id="answersGroup">
                <div class="form-group">
                    <label>Respostas Possíveis:</label>
                    <div id="answersContainer"></div>
                    <button class="btn btn-secondary btn-small" onclick="addAnswerField()" style="margin-top:10px">+ Adicionar Resposta</button>
                </div>
            </div>

            <div class="form-group"><label for="findingInfo">Texto de Informação (Opcional):</label><textarea id="findingInfo" rows="4" placeholder="Explique o que é este achado..."></textarea></div>
            <div class="button-group"><button id="saveFindingBtn" class="btn btn-success">Salvar</button><button class="btn btn-secondary" onclick="closeFindingModal()">Cancelar</button></div>
        </div>
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3>Informações sobre o Achado</h3><span class="close" onclick="closeInfoModal()">&times;</span></div>
            <div id="infoModalContent" style="white-space:pre-wrap;line-height:1.7"></div>
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Como Usar o Prontuário Fácil</h3>
                <span class="close" onclick="closeHelpModal()">&times;</span>
            </div>
            <div id="helpModalContent" style="line-height:1.7">
                <h4>Passo 1: Selecione os Exames</h4>
                <p>Na tela inicial, clique nos roteiros de examinação que deseja incluir na sua consulta. Os exames selecionados ficarão destacados. Você pode adicionar seus próprios exames customizados clicando em "Adicionar Novo Exame" (não recomendamos).</p>
                
                <h4>Passo 2: Registre os Achados</h4>
                <p>Após selecionar os exames e clicar em "Prosseguir", você verá uma lista de seções e perguntas para cada exame. Clique nos botões (ex: "Sim", "Não") para registrar suas observações. Para perguntas de texto (como Sinais Vitais), basta digitar o valor no campo correspondente.</p>
                <p>À direita, um painel de pré-visualização mostrará o laudo sendo montado em tempo real.</p>
                
                <h4>Passo 3: Gere e Copie o Laudo</h4>
                <p>Quando terminar de registrar os achados, clique em "Gerar Laudo". O texto final será apresentado. Você pode então clicar em "Copiar" para transferir o laudo para a área de transferência e colar onde precisar.</p>

                <hr style="margin: 20px 0;">

                <h4>Recursos Adicionais:</h4>
                <ul style="padding-left: 20px;">
                    <li><strong>Adicionar Achados:</strong> Dentro de um exame, na tela de registro, você pode adicionar perguntas customizadas (achados) a qualquer seção clicando no botão "+".</li>
                    <li><strong>Importar/Exportar:</strong> Use os botões no cabeçalho para salvar ("Exportar") suas configurações de exames e achados customizados em um arquivo. Você pode carregar ("Importar") esse arquivo em outro computador ou navegador para ter seus dados sempre à mão.</li>
                    <li><strong>Limpar Sessão:</strong> Este botão apaga os exames e achados selecionados na sua sessão atual, permitindo começar um novo laudo do zero.</li>
                </ul>
            </div>
        </div>
    </div>

<script src="dadosnativos.js"></script>
<script src="js/utils.js"></script>
<script src="js/main.js"></script>

</body>
</html>